<h1>Instructions</h1>

<h2>Initiation</h2>

<p>Your input should be a haplotype file of the following form:</p>

<table>
  <tr>
    <th>sid</th>
    <th>rs0000001_A</th>
    <th>rs0000002_G</th>
    <th>rs0000003_C</th>
    <th>...</th>
  </tr>
  <tr>
    <th>0001</th>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>...</td>
  </tr>
  <tr>
    <th>0001</th>
    <td>0</td>
    <td>1</td>
    <td>0</td>
    <td>...</td>
  </tr>
  <tr>
    <th>0002</th>
    <td>1</td>
    <td>0</td>
    <td>0</td>
    <td>...</td>
  </tr>
  <tr>
    <th>0002</th>
    <td>1</td>
    <td>0</td>
    <td>0</td>
    <td>...</td>
  </tr>
 </table>
 
 <p>Each row is chromosome from subject sid; note that each has two chromosomes with the same id.  Alternate alleles of SNP </kbd>rsid_Alt</kbd> are indicated with a 1 and reference alleles with a 0.  Transpose the file with one of the following commands.  Note that the sid row is purposely excluded.</p>
 
 <pre>
 <code>
 n_fields=$(awk 'END{print NF}' file)
 for i in `seq 2 $n_fields`
 do
    cut -f$i file | paste -s # paste column i as a row
 done > transpose_file
 </code>
 </pre>
 
 The output will be something like:
 
 <table>
  <tr>
    <th>rs0000001_A</th>
    <td>0</td>
    <td>0</td>
    <td>1</td>
    <td>1</td>
    <td>...</td>
  </tr>
  <tr>
    <th>rs0000002_G</th>
    <td>0</td>
    <td>1</td>
    <td>0</td>
    <td>0</td>
    <td>...</td>
  </tr>
  <tr>
    <th>rs0000003_C</th>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>...</td>
  </tr>
 </table>
 
 <p>The initiation step overlaps columns of <kbd>transpose_file</kbd>.  For users not running on an HPC, the <kbd>ChromosomeOverlap_initiation_sub.sh</kbd> program loops through all <i>variable</i> chromosomes and overlaps them with each column <var>j</var> of the transposed matrix such that <var>j>i<sub>&sigma;-1</sub>.</p>
  
  <pre>
  <code>
  sh ChromosomeOverlap_initiation_sub.sh transpose_file 1 "NAME" ""
  </code>
  </pre>
  
  <p>The first input is the tranposed matrix, the second is <var>&sigma;-1</var> (i.e., the number of fixed chromosomes in each overlap) and NAME is an optional input for naming the output file; a good name is the chromosome regions, e.g., <kbd>chr11.69231642-69431642</kbd>.  The fourth empty input is for indicating a range of the <var>2N</var>-choose-<var>(&sigma;-1)</var> combinatins of fixed chromosomes.</p>
  
  <p>If a range of tuples, say 0 to 49, is to be computed, the R script</p> 
  
  <pre>
  <code>
  Rscript index2combo2.R I=0 n=100 sigma=1
  </code>
  </pre> 
  
  finds the tuple of <var>&sigma-1=1</var> fixed chromosomes corresponding to the linear index 0 (i.e., the 0<sup>th</sup> tuple) when there are <var>n=100</var> total chromosomes.  This is a trivial computation when <var>&sigma-1=1</var>, but the program easily extends to larger values of <kbd>&sigma;</kbd></p>
  
  <p>The intermediate files generated by <kbd>ChromosomeOverlap_initiation.sh</kbd> look like </p>
  
  <table>
    <tr>
      <td>10</td>
      <td>00</td>
      <td>01,02,04,07</td>
    </tr>
    <tr>
      <td>10</td>
      <td>10</td>
      <td>03,05</td>
    </tr>
    <tr>
      <td>10</td>
      <td>01</td>
      <td>06,08</td>
    </tr>
    <tr>
      <td>10</td>
      <td>11</td>
      <td>09</td>
    </tr>
   </table>
    
<p>The first column is the number of the variable chromosome (i.e., the tenth column of the matrix, including the column of rsids).  The second column is the "pattern type," which indicates the allele combination when a single fixed chromosome is placed next to the fixed one.  The third column is the list of SNPs (starting from 01) at which the indiciated pattern is observed.  Chromosome Overlap will produce a <i>meta-chromosome</i> <kbd>01_0,02_0,04_0,07_0,09_1</kbd> indicating SNPs 1, 2, 4, and 5 are all in the REF state and SNP 9 is in the ALT state; this is the pattern shared by the fixed chromosome and the variable chromosome.</p>

<p>All meta-chromosomes are collected with their counts in the file <kbd>Pattern.NAME.2,j.txt</kbd>. The name <kbd>2,j</kbd> indicates a fixed chromosome <kbd>2</kbd> has been combined with all variable chromosomes <kbd>j</kbd>.  But since we want to range through all fixed chromosomes and save the patterns in one place, the patterns generated by <kbd>3,j</kbd>, <kbd>4,j</kbd>, etc. have been collected here as well.  If you had indicated that a range of tuples of fixed chromosomes (i.e., columns of the transposed matrix) be considered, say 2 to 51 and 52 to 101, another file <kbd>Pattern.NAME.52,j.txt</kbd> would have been generated.  You would then combine different Pattern files using</p>

<pre>
<code>
ChromosomeOverlap_initiation_combine.sh NAME 1 "Iteration000"
</code>
</pre>

<p>NAME is the name variable you used in the previous step to name your output file.  We will not need to deal with the second input, but it should be left as "1."  The name Iteration000 will be appended to the combined file so that we know these meta-chromosomes have come from the initial round.  This program workds by finding the "minimum" label by computing the "distance" between each number (e.g., the 2 in <kbd>2,j</kbd> and the 50 in <kbd>50,j</kbd>) and its position in the string (1 for both); clearly this favors suffixes with small numbers in the leftmost positions.  The combined file <kbd>Pattern_combined.Iteration000.NAME.2,j.txt is appended with the minimum index over all Pattern files which have been combined.  The files used to make the combined file will be moved to a folder <kbd>Iteration000</kbd> in case you need them later.</p>

<p>A note is needed on the other files you may see.  For any combination of <var>&sigma;</var> chromosomes <var>i<sub>1</sub>,...,i<sub>&sigma;-1</sub></var> there will be several different paritions of the chromosomes into non-empty subsets.  The number of paritions of <var>&sigma;</var> things into <var>k</var> non-empty subsets is given by the <i>Stirling number</i> <var>S<sub>&sigma;,k</sub></var> (see the function <kbd>StirlingSum.sh</kbd>).  Chromosome Overlap currently only considers the single partition into one subset.  But for two chromosomes it is also possible to divide the combination into two subsets of one chromosome each; the alleles that are exclusive to each are output as a <i>split pattern</i> in the file appended <kbd>2+j</kbd>; you'll notice that these patterns are complementary.  You may notice some intermediate files with names like <kbd>2,j_2,j_2,j</kbd> or <kbd>2,j_2+j_j</kbd>, which indicate (i) the fixed/variable chromosomes being considered (i.e., <var>2</var> and <var>j</var>), (ii) the partition being evaluated (<var>2,j</var> for one subset or <var>2+j</var> for two subsets), and (iii) the meta-chromosomes exclusive to that subset (e.g., the alleles shared by 2 and <var>j</var> or by <var>j</var> alone.  Larger values of <var>&sigma;</var> can be used, but they will produce more subsets. The second input in <kbd>ChromosomeOverlap_initiation_combine.sh</kbd> indicates whether (1) or not (0) partitions into the same number of subsets should be combined into one output file.</p>  
 
 <h2>Filtering</h2>
 
 
